pipelines:
  default:
    - parallel:
        - step:
            caches:
              - gradle
            name: Debug Build
            image: uber/android-build-environment:latest
            script:
              - chmod a+x ./gradlew
              - ./gradlew assembleDebug
            artifacts:
              - app/build/outputs/**

        - step:
            name: Test with Coverage
            image: uber/android-build-environment:latest
            script:
              - ./gradlew test
  #              - ./gradlew createDebugCoverageReport

  branches:
    master:
      - parallel:
          - step:
              name: Build Debug
              image: uber/android-build-environment:latest
              caches:
                - gradle
              script:
                - echo "$SIGNING_JKS_FILE" | base64 -d > upload-keystore.jks
                - ./gradlew assembleDebug
              artifacts:
                - app/build/outputs/**

          - step:
              name: Test
              image: uber/android-build-environment:latest
              script:
                - ./gradlew test
#                - ./gradlew createDebugCoverageReport